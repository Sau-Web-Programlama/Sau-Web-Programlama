@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>

    <script>
        $(document).ready(function () {
            // Değişkenleri tanımlıyoruz
            const trainerSelect = $('#TrainerId');
            const dateInput = $('#AppointmentDate');
            const timeSelect = $('#AppointmentTime');

            // -------------------------------------------------------------
            // TARİH KONTROLÜ (Hata veren kısım buraya taşındı ve düzeltildi)
            // -------------------------------------------------------------

            // Bugünün tarihinden önceki tarihleri seçememe
            const today = new Date().toISOString().split('T')[0];

            // jQuery kullanarak min attribute'ünü ayarla
            if (dateInput.length) {
                dateInput.attr('min', today);
            }


            // -------------------------------------------------------------
            // AJAX ile MÜSAİT SAATLERİ DOLDURMA
            // -------------------------------------------------------------

            // Fonksiyon: Müsait saatleri API'den çeker ve doldurur
            function updateAvailableSlots() {
                const trainerId = trainerSelect.val();
                const selectedDate = dateInput.val();

                timeSelect.empty();
                timeSelect.append($('<option>', { value: '', text: 'Önce antrenör ve tarih seçiniz...' }));

                // Eğer antrenör seçili değilse veya tarih seçili değilse işlemi durdur
                if (!trainerId || !selectedDate) {
                    return;
                }

                timeSelect.append($('<option>', { value: '', text: 'Müsaitlik aranıyor...' }));

                $.ajax({
                    url: '@Url.Action("GetAvailableSlots", "Trainers")',
                    type: 'GET',
                    data: { trainerId: trainerId, date: selectedDate },
                    success: function (slots) {
                        timeSelect.empty();
                        if (slots.length > 0) {
                            timeSelect.append($('<option>', { value: '', text: 'Saat seçiniz...' }));
                            slots.forEach(function (slot) {
                                timeSelect.append($('<option>', {
                                    value: slot,
                                    text: slot
                                }));
                            });
                        } else {
                            timeSelect.append($('<option>', { value: '', text: 'Bu gün için müsaitlik yok.' }));
                        }
                    },
                    error: function () {
                        timeSelect.empty();
                        timeSelect.append($('<option>', { value: '', text: 'Hata oluştu!' }));
                    }
                });
            }

            // Antrenör veya Tarih değiştiğinde fonksiyonu çalıştır
            trainerSelect.on('change', updateAvailableSlots);
            dateInput.on('change', updateAvailableSlots);

            // Sayfa yüklendiğinde bir kez çalıştır (varsa varsayılan değerler için)
            updateAvailableSlots();
        });
    </script>
}